<!DOCTYPE html>

<!--
  ~ Copyright (c) 2014 Domenic Muskulus, Alexander Mersmann.
  ~ Licensed under the MIT License.
  -->

<html xmlns:th="http://www.thymeleaf.org" ng-app>
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <title>NAK Exam Management</title>

        <link href="../../../static/css/vendor/bootstrap.min.css" th:href="@{/static/css/vendor/bootstrap.min.css}" rel="stylesheet"/>
        <link href="../../../static/css/style.css" th:href="@{/static/css/style.css}" rel="stylesheet"/>

    </head>
    <body>

        <th:block th:replace="layout :: layout-header"></th:block>

        <div class="container">
            <form id="form-create-exam" th:action="@{/exam/}" role="form" accept-charset="UTF-8" method="post">
                <div class="form-group">
                    <label th:text="#{input.email}">Course</label>
                    <select class="selectpicker step1">
                        <option>Please select...</option>
                    </select>
                    <select class="selectpicker step2" name="examModel.exam.course.id">
                        <option>Please select...</option>
                    </select>
                    <select class="selectpicker step3" name="examModel.lecturers.id" multiple>
                        <option>Please select...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="date" th:text="#{input.date}">Date</label>
                    <input id="date" type="text" name="examModel.exam.date" class="form-control" th:placeholder="#{input.date}" placeholder="Date" required>
                </div>
                <button class="btn btn-primary btn-block" type="submit">Create exam</button>
            </form>
        </div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="../../../static/js/vendor/bootstrap.min.js" th:src="@{/static/js/vendor/bootstrap.min.js}"></script>
        <script src="../../../static/js/vendor/jquery.cascadingdropdown.js" th:src="@{/static/js/vendor/jquery.cascadingdropdown.js}"></script>
        <script src="../../../static/js/script.js" th:src="@{/static/js/script.js}"></script>
        <script th:inline="javascript">
            var maniples = /*[[${action.examModel.maniples}]]*/ null;
            var manipleCourses = /*[[${action.examModel.manipleCourses}]]*/ null;
            var course = null;

            // TODO remove dropdowns from post

            $(function () {
                var $dropdowns = $('.selectpicker');

                $('#form-create-exam').cascadingDropdown({
                    selectBoxes: [
                        {
                            selector: '.step1',
                            selected: '4.3',
                            paramName: 'maniple',
                            requireAll: true,
                            source: maniples.map(function(maniple, index) {
                                return {
                                    label: maniple.abbreviation,
                                    value: maniple.id,
                                    selected: false
                                };
                            })
                        },
                        {
                            selector: '.step2',
                            requires: ['.step1'],
                            paramName: 'course',
                            requireAll: true,
                            source: function(request, response) {
                                if (!manipleCourses[request.maniple]) return;
                                response(manipleCourses[request.maniple].map(function(course, index) {
                                    return {
                                        label: course.title,
                                        value: course.id,
                                        selected: false
                                    };
                                }));
                                //$dropdowns.selectpicker('refresh');
                            }
                        },
                        {
                            selector: '.step3',
                            requires: ['.step1', '.step2'],
                            paramName: 'lecturer',
                            requireAll: true,
                            source: function(request, response) {
                                if (!request.maniple || !request.course) return;

                                course = manipleCourses[request.maniple].find(function(course, index) {
                                    return course.id == request.course;
                                });

                                if (!course) return;

                                response(course.lecturers.map(function(lecturer, index) {
                                    return {
                                        label: lecturer.name,
                                        value: lecturer.id,
                                        selected: false
                                    };
                                }));
                                //$dropdowns.selectpicker('refresh');
                            }
                        }
                    ]
                });
            });
        </script>
    </body>
</html>
